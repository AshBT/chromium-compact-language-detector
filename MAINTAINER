NOTE: This file is a maintainer file and should not be included in the distribution. In other words, it must not appear anywhere in the
Makefile.am.

===========
C++ library
===========

C++ library versionning
=======================

Public API version
------------------

When the version changes, modify the following lines in the file `configure.ac`:
AC_INIT([libcld], [0.1], [lucene@mikemccandless.com], [compact-language-detector], [http://code.google.com/p/chromium-compact-language-detector/])
AC_SUBST([CLD_API_VERSION], [0.1])

Libtool version
---------------

Libtool has a particular versionning, not meant for human usage, but for automatic library management in the system.
You must change the version at every public release of the library where anything changed in the source code, even when this is only a
revision change with only minor cosmetic changes, and no real usage effects. But update only for a release.
Hence libtool and public version are not meant to be following each other at all and are fully independent.

For details: http://www.gnu.org/software/libtool/manual/html_node/Updating-version-info.html

Line to modify in `configure.ac`:
AC_SUBST([CLD_LT_VERSION], [0:0:0])

Makefile Targets
================

- make dist: generates compact-language-detector-0.1.tar.gz (0.1 will be replaced by the public version you set earlier).

- make distcheck: same as make dist but will simulate a distribution installation in a temporary folder to verify that the generated package
  contains everything necessary for a full installation.

- make pkg-deb: creates a library (only dynamic) package and a -dev (with headers) packages under release/.

- make release: implies both distcheck and pkg-deb and move everything under release/ (you will hence find there 2 .deb and 1 .tar.gz).

TODO: make pkg-rpm, pkg-ebuild, API doc.

Release Process
---------------

$ ./cleanrepo.sh
$ ./autogen.sh
$ ./configure
$ make release

You'll find under release/ a .tar.gz for manual installation and 2 .deb for Debian/Ubuntu inclusion.
Test the .deb in particular by installing them and trying them.

Finally tag the repository at the revision the release has been made with the following command:
$ hg tag cld-{version}
For instance:
$ hg tag cld-0.1

==============
Python library
==============

(1) update versionning in setup.py, in the setup() function, there is a version argument.

(2) Build then test the distribution before release:
$ python setup.py sdist

A dist/ directory will be created. Verify that it contains all necessary packages for installation (source files, test files, etc.).
If some files are missing, you may need to update the MANIFEST.in.
Simplest way to check the package is by untaring the file inside, and try to build with:
$ python setup.py build
Then test:
$ python setup.py test

(3) Finally release:
[ $ python setup.py register ] => actually this does not seem necessary for updates.
$ python setup.py sdist upload

Then follow instructions if any.

Finally tag the repository at the revision the release has been made with the following command:
$ hg tag pycld-{version}
For instance:
$ hg tag pycld-0.1
